一、如何安装和启动

1、安装（首次使用只需执行一次）

（1）Windows：双击 00_install_windows.bat
（2）macOS 或 Linux：双击 00_install_mac_linux.sh（或在终端中执行：bash 00_install_mac_linux.sh）

等待程序安装，过程可能比较长，主要取决于网络环境，要耐心等待~
直到显示：【Done. Next: xxx, 请按任意键继续. . .】，这个时候就可以关闭命令行了。

说明：安装脚本已默认使用清华镜像源（pypi.tuna.tsinghua.edu.cn），适配国内网络环境。

2、启动（每次使用都执行）

（1）Windows：双击 01_start_windows.bat
（2）macOS 或 Linux：双击 01_start_mac_linux.sh（或在终端中执行：bash 01_start_mac_linux.sh）

启动后会自动在后台启动服务，并自动打开浏览器进入设置页（/setup）。
如果 8000 端口被占用，会自动换到 8001 / 8002 等可用端口。
注意，在使用浏览器操作时，除非已经完成工作，否则不要关闭新打开的命令行窗口。

3、关闭程序

- 直接关闭启动时弹出的命令行窗口即可；
- 或在命令行窗口中按 Ctrl + C 停止服务。


二、如何使用

为了方便开发，界面为全英文，可以使用浏览器自带的网页翻译功能翻译成中文~

1、选择音乐源数据库与目录文件

进入浏览器界面后，按提示选择两项：

（1）音乐源数据库：装有音乐文件的文件夹。
    推荐下载 NAS 中的【团队空间/猫城/整理后的商用音乐资源/LicensedMusics】并解包后，选择其中的 LicensedMusic 文件夹。

（2）目录文件（Catalog / MetaData）：一个记录你对音乐的所有评价的 JSON 文件。
    - 选择现有 JSON：会读入现有数据（例如团队共享的 data1.json）。
    - 新建 JSON：在选择文件时输入一个新的文件名并保存，即会创建一个全新的目录文件（这是创建新数据的唯一方式）。

【下面内容是AI生成的，没有错误但比较冗长。选择性地参考即可。如果有问题不清楚随时敲妙~】


2、进入管理界面后，可根据界面情况进行音乐评价（打分、贴标签、评论等），详细使用说明如下：

三、界面说明（管理页）

1、左侧：音乐库

- 搜索框：支持按文件名/虚拟键/备注等关键字检索。
- 过滤器：可按主用途（primary_role）、标签、量表区间（如 energy/darkness 等）、是否可循环、时长范围等过滤。
- 音乐列表：点击任意一首进入编辑。

2、右侧：音乐详情（选中某首歌后显示）

- 播放器：播放/暂停、进度条拖动、时长显示。
- 可选 A/B 预览：如果设置了 loop_start_sec / loop_end_sec，可进行片段循环预听（用于检查循环点）。
- 元数据区：主用途、标签、量表（评分）、BPM、备注、循环信息、授权信息等。

3、保存

- 修改会在你点击“保存/应用”后写入 JSON。


4、快捷键（如果你习惯键盘操作）

- 空格：播放/暂停
- 上/下：切换上一首/下一首
- Ctrl + S：保存


四、推荐的评价流程

1）先听一遍，确定“主用途（primary_role）”
   这是一个“默认锚点”，不是绝对真理。

2）再贴“标签（Tags）”
   标签允许多选：一首歌可以同时 dark + sad + mysterious，也可以同时适用于 exploration + cutscene。

3）再打“量表分（Scales）”
   例如 energy、darkness、tension 等用 0–5 的分值更稳定。

4）最后写备注（Notes）
   用一句话说明你会把它用在什么场景里，例如：
   “适合黄昏的无人街道、主角独白、结尾字幕。”


五、标签管理（全局）

1、为什么要管理标签

团队多人协作时，标签命名容易分裂（例如 melancholic vs sad）。
所以工具允许统一维护“标签组”和“标签值”，保证大家用同一套词表。

2、如何新增/删除“标签组”（Tag Group）

在管理页点击“Manage Tags / 管理标签”：

- 新增标签组：输入组名（例如 instruments、styles、locations），点击新增。
- 删除标签组：点击删除。
  注意：删除标签组会从词表中移除该组，并同时从所有音乐条目中移除该组数据（避免残留脏数据）。

3、如何新增/删除“标签值”（Tag Value）

- 新增：在指定标签组中添加一个新值。
- 删除：点击删除某个值。
  注意：删除标签值会同时从所有音乐条目中移除该值（全局一致性）。

4、锁定标签组（请务必读）

以下四个标签组用于“虚拟键自动生成”，属于系统必需：
- moods
- usable_in_contexts
- instruments
- styles

它们会在“管理标签”中显示为 Locked（锁定），不能删除标签组（避免破坏虚拟键规则）。
（你仍然可以在这些组里新增/删除标签值，若团队确实需要。）


六、量表管理（全局）

1、为什么要管理量表

不同项目可能需要不同的评分维度。
例如除了 energy/darkness 之外，你们可能还需要 “温暖度 warmth”、“科技感 sci_fi”、“危险感 danger”等。

2、如何新增/删除量表、设置最小/最大值

在管理页点击“Manage Scales / 管理量表”：

- 新增量表：填写量表名称（建议英文 + 下划线，例如 emotional_weight），并设置 min/max/default。
- 删除量表：会从词表移除该量表，并从所有音乐条目中移除对应字段。
- 修改 min/max/default：
  当你缩小范围时，系统会把所有歌曲的该量表数值“夹逼/裁剪（clamp）”到新范围内，保证数据合法。


七、虚拟键（Virtual Key）自动生成

1、虚拟键是什么

虚拟键是你们在项目里引用音乐的“稳定名字”，不依赖原始文件名。
本工具不会重命名原始音乐文件，只在 JSON 中维护虚拟键。

2、虚拟键规则（固定模式）

虚拟键统一遵循：
    mood_context_instrument_style_sn

其中：
- mood / context / instrument / style：从下拉选项中选择（来自对应标签组的词表）
- sn：自动生成的序号，用于避免重名冲突（你不需要手动填）

示例：
- dark_exploration_piano_modern_003
- warm_town_guitar_fantasy_012

3、如何使用

在音乐详情页的“Virtual Key Builder / 虚拟键生成”区域：
- 选择 mood / context / instrument / style
- 点击生成/应用
系统会自动分配一个不会冲突的 sn，并写入该音乐条目的 virtual_key。

注意：这套虚拟键生成是“附加功能”，不会替代你原本的多选标签系统。
你仍然可以给歌曲贴多个 moods、多个 contexts 等标签。


八、目录扫描与同步（Rescan）

1、什么时候需要 Rescan

- 在音乐源数据库中新增/删除了音乐文件
- 音乐文件位置变动
- 从云端拉取了更新后的目录文件（JSON）

2、Rescan 会做什么

- 递归扫描音乐源数据库下的音频文件
- 新文件：自动加入目录并填默认元数据
- 文件移动/改名：会尝试用文件指纹（hash/size/mtime）重连
- 找不到文件：标记 missing_file=true，但不会丢失你之前的评价数据
- 重复文件：标记 duplicate_of


九、跨设备/协作建议（很重要）

1、跨设备路径不同怎么办

没关系。
目录文件里保存的是相对路径；当你在新设备上重新选择“音乐源数据库”后，工具会以你当前选择的路径为准。

2、团队协作如何避免冲突

- 目录文件（JSON）建议用 Git 或云盘同步。
- 同一时间尽量只让一个人编辑同一个 JSON（避免合并冲突）。
- 每次大规模修改前，先备份一份 JSON（复制文件即可）。


十、常见问题（FAQ）

1、双击启动后没有自动打开网页

- 看启动窗口里是否打印了访问地址（http://127.0.0.1:xxxx）。
- 把这个地址复制到浏览器打开即可。

2、安装失败 / 下载很慢

- 国内网络环境下，脚本已默认使用清华源。
- 若仍失败，多半是网络波动，重新执行一次安装脚本即可。

3、管理页列表为空

- 确认在 /setup 页面选择了正确的音乐源数据库与目录文件。
- 点击一次 Rescan 让系统同步音乐文件。
- 如果音乐目录很大，首次扫描会花点时间。


4、不小心删除了标签/量表怎么办

- 删除是全局生效的，建议从备份的 JSON 恢复。
